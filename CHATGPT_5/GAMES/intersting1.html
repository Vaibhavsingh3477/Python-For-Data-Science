<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Whisper Canvas — Interactive Ambient Story</title>
<style>
  :root{
    --bg1:#05060a;
    --bg2:#0b0e17;
    --accent:#8bd3dd;
    --soft:#ffffffcc;
    --glass:#ffffff10;
    --glass-border:#ffffff22;
    --glow:#8bd3dd55;
    --caret:#8bd3dd;
  }
  html,body{
    margin:0; height:100%; background: radial-gradient(1200px 600px at 70% 20%, var(--bg2), var(--bg1));
    color:#e8eef5; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; overflow:hidden;
  }
  canvas#space{position:fixed; inset:0; z-index:0;}
  .vignette::after{
    content:""; position:fixed; inset:-5vmin; pointer-events:none; z-index:1;
    background: radial-gradient(ellipse at center, #0000 55%, #0008 90%, #000d 100%);
  }
  .center{
    position:fixed; inset:0; display:grid; place-items:center; z-index:2; padding:2rem;
  }
  .panel{
    width:min(820px, 92vw);
    background: linear-gradient(180deg, #ffffff05, #00000020);
    border:1px solid var(--glass-border); backdrop-filter: blur(12px) saturate(120%);
    box-shadow: 0 20px 60px #0008, 0 0 0 1px #ffffff09 inset;
    border-radius: 18px; padding: 22px 22px 18px;
  }
  .title{
    font-weight:700; font-size: clamp(22px, 3vw, 32px); letter-spacing:0.5px; margin:4px 0 8px;
    display:flex; align-items:center; gap:12px;
  }
  .title .pill{
    font-size:12px; border:1px solid var(--glass-border); padding:4px 8px; border-radius:999px; color:#bfe9ee;
    background: linear-gradient(180deg, #8bd3dd22, #0000);
  }
  .glitch{
    position:relative; display:inline-block; text-shadow: 0 0 10px var(--glow);
    animation: glowPulse 3.5s ease-in-out infinite;
  }
  .glitch::before, .glitch::after{
    content:attr(data-text); position:absolute; left:0; top:0; mix-blend-mode:screen; opacity:0.15;
  }
  .glitch::before{ transform:translate(1px, 0); color:#7ffefd; animation: glitchX 2.6s infinite; }
  .glitch::after{ transform:translate(-1px, 0); color:#b388ff; animation: glitchY 3.3s infinite; }
  @keyframes glowPulse{ 0%,100%{ text-shadow:0 0 6px var(--glow);} 50%{ text-shadow:0 0 18px var(--glow);} }
  @keyframes glitchX{ 0%,100%{transform:translate(0,0)} 10%{transform:translate(2px,-1px)} 20%{transform:translate(-1px,1px)} 30%{transform:translate(1px,0)} }
  @keyframes glitchY{ 0%,100%{transform:translate(0,0)} 15%{transform:translate(-2px,1px)} 40%{transform:translate(1px,-1px)} 75%{transform:translate(-1px,0)} }

  .story{
    margin-top: 10px; min-height: 120px; line-height:1.6; font-size: clamp(16px, 2.2vw, 18px);
    color: var(--soft); position:relative; padding-right: 6px;
  }
  .caret{
    width: 8px; height: 1.2em; background: var(--caret); display:inline-block; margin-left: 6px; vertical-align:-0.2em;
    animation: blink 1.1s step-end infinite;
  }
  @keyframes blink{ 0%,100%{opacity:0.0} 50%{opacity:0.8} }

  .controls{
    display:flex; flex-wrap:wrap; gap:10px; margin-top:16px; align-items:center;
  }
  .btn{
    border:1px solid var(--glass-border); background: linear-gradient(180deg, #ffffff10, #00000010);
    color:#e8eef5; padding:10px 14px; border-radius: 12px; cursor:pointer; transition: transform .08s ease, background .2s;
  }
  .btn:hover{ transform: translateY(-1px); background: linear-gradient(180deg, #ffffff15, #00000015); }
  .btn:active{ transform: translateY(0); }
  .toggle{
    display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:12px; border:1px solid var(--glass-border);
    background:#ffffff08; cursor:pointer; user-select:none;
  }
  .label{ font-size:12px; opacity:.8; }
  input[type="range"]{
    -webkit-appearance:none; width:160px; height:6px; border-radius:999px; background:#ffffff2a; outline:none;
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent); border:1px solid #ffffff66;
    box-shadow: 0 0 0 3px #8bd3dd33;
  }
  .footer{
    margin-top: 10px; font-size:12px; opacity:.7; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
  }
  .hint{ opacity:.7 }
  .badge{ color:#9adfe6 }
</style>
</head>
<body class="vignette">
<canvas id="space"></canvas>

<div class="center">
  <div class="panel">
    <div class="title">
      <span class="glitch" data-text="Whispers in Auraiya">Whispers in Auraiya</span>
      <span class="pill">ambient story</span>
    </div>

    <div class="story" id="story">
      <!-- Typewriter text appears here -->
      <span class="caret"></span>
    </div>

    <div class="controls">
      <button class="btn" id="begin">Begin</button>
      <button class="btn" id="stop" disabled>Stop</button>

      <label class="toggle">
        <input type="checkbox" id="hb" />
        <span>Heartbeat</span>
      </label>

      <label class="toggle">
        <input type="checkbox" id="lang" />
        <span class="label" id="langLabel">EN</span>
      </label>

      <label class="toggle">
        <span class="label">Volume</span>
        <input type="range" id="vol" min="0" max="100" value="40" />
      </label>
    </div>

    <div class="footer">
      <div class="hint">Tip: Move your mouse—dust drifts toward your intent.</div>
      <div class="badge">No files, pure HTML/CSS/JS + procedural audio</div>
    </div>
  </div>
</div>

<script>
/* ========= Narrative (EN/HI) ========= */
const EN_LINES = [
  "The night holds its breath at the edge of the courtyard.",
  "Between neem leaves, a silver hush listens back.",
  "Footsteps you meant to take arrive before you do.",
  "Somewhere, a gate remembers the hand that closed it.",
  "If you stand very still, the wind will finish your thought."
];

const HI_LINES = [
  "आँगन की चौखट पर रात अपनी साँस रोक लेती है।",
  "नीम की पत्तियों के बीच, चाँदी-सी ख़ामोशी जवाब देती है।",
  "जो क़दम तुम्हें रखने थे, तुमसे पहले पहुँच जाते हैं।",
  "कहीं कोई फाटक उस हथेली को याद करता है जिसने उसे बंद किया था।",
  "एकदम स्थिर रहो—हवा तुम्हारा वाक्य पूरा कर देगी।"
];

let currentLang = "en";

/* ========= Typewriter ========= */
const storyEl = document.getElementById("story");
let tw = { lineIndex:0, charIndex:0, running:false, timer:null };

function getLines(){ return currentLang === "en" ? EN_LINES : HI_LINES; }

function renderType(){
  const lines = getLines();
  const visible = lines.slice(0, tw.lineIndex).join("\n") + (tw.lineIndex < lines.length ? (tw.lineIndex>0?"\n":"") + lines[tw.lineIndex].slice(0, tw.charIndex) : "");
  storyEl.innerHTML = visible.replace(/\n/g,"<br>") + ' <span class="caret"></span>';
}

function typeStep(){
  const lines = getLines();
  if(!tw.running) return;
  if(tw.lineIndex >= lines.length){ tw.running=false; return; }
  const line = lines[tw.lineIndex];

  if(tw.charIndex < line.length){
    tw.charIndex++;
    renderType();
    const ch = line[tw.charIndex-1];
    const base = 26;
    const jitter = (ch === " " ? 10 : Math.random()*16);
    setTimeout(typeStep, base + jitter);
  } else {
    // Pause at end of line
    setTimeout(()=>{
      tw.lineIndex++;
      tw.charIndex=0;
      renderType();
      setTimeout(typeStep, 300);
    }, 420);
  }
}
function startType(){
  tw.running = true; tw.lineIndex=0; tw.charIndex=0; renderType(); setTimeout(typeStep, 400);
}
function resetType(){
  tw.running=false; clearTimeout(tw.timer); tw.lineIndex=0; tw.charIndex=0; renderType();
}

/* ========= Procedural Audio ========= */
let audio = {
  ctx:null, master:null, droneA:null, droneB:null, windSrc:null, windLP:null, windHP:null,
  hbInterval:null, lfo:null, lfoGain:null
};

function createAudio(){
  audio.ctx = new (window.AudioContext || window.webkitAudioContext)();
  audio.master = audio.ctx.createGain(); audio.master.gain.value = 0.3;
  audio.master.connect(audio.ctx.destination);

  // Drone oscillators
  audio.droneA = audio.ctx.createOscillator();
  audio.droneB = audio.ctx.createOscillator();
  audio.droneA.type = "sine"; audio.droneB.type = "sine";
  audio.droneA.frequency.value = 72; // Hz
  audio.droneB.frequency.value = 72 * Math.pow(2, -3/12); // detuned minor third
  const dGain = audio.ctx.createGain(); dGain.gain.value = 0.14;
  audio.droneA.connect(dGain); audio.droneB.connect(dGain);
  dGain.connect(audio.master);

  // LFO for gentle tremolo
  audio.lfo = audio.ctx.createOscillator(); audio.lfo.type="sine"; audio.lfo.frequency.value = 0.12;
  audio.lfoGain = audio.ctx.createGain(); audio.lfoGain.gain.value = 0.1;
  audio.lfo.connect(audio.lfoGain); audio.lfoGain.connect(dGain.gain);

  // Wind (filtered noise)
  const bufferSize = 2 * audio.ctx.sampleRate;
  const noiseBuffer = audio.ctx.createBuffer(1, bufferSize, audio.ctx.sampleRate);
  const data = noiseBuffer.getChannelData(0);
  for(let i=0;i<bufferSize;i++){ data[i] = Math.random() * 2 - 1; }
  audio.windSrc = audio.ctx.createBufferSource();
  audio.windSrc.buffer = noiseBuffer; audio.windSrc.loop = true;

  audio.windLP = audio.ctx.createBiquadFilter(); audio.windLP.type="lowpass"; audio.windLP.frequency.value = 600;
  audio.windHP = audio.ctx.createBiquadFilter(); audio.windHP.type="highpass"; audio.windHP.frequency.value = 80;

  const wGain = audio.ctx.createGain(); wGain.gain.value = 0.18;

  audio.windSrc.connect(audio.windLP); audio.windLP.connect(audio.windHP); audio.windHP.connect(wGain); wGain.connect(audio.master);

  // Start sources
  audio.droneA.start(); audio.droneB.start(); audio.windSrc.start();
  audio.lfo.start();

  // Gentle filter wander
  let t = 0;
  function wander(){
    t += 0.005;
    const lp = 400 + 250 * (0.5 + 0.5*Math.sin(t*0.7));
    const hp = 60 + 40 * (0.5 + 0.5*Math.sin(t*1.3 + 1.2));
    audio.windLP.frequency.setTargetAtTime(lp, audio.ctx.currentTime, 0.4);
    audio.windHP.frequency.setTargetAtTime(hp, audio.ctx.currentTime, 0.4);
    if(audio.ctx.state !== "closed") requestAnimationFrame(wander);
  }
  wander();
}

function startHeartbeat(enabled){
  stopHeartbeat();
  if(!enabled || !audio.ctx) return;
  const g = audio.ctx.createGain(); g.gain.value = 0.0; g.connect(audio.master);
  const o = audio.ctx.createOscillator(); o.type="sine"; o.frequency.value = 50; o.connect(g); o.start();
  let bpm = 52;
  audio.hbInterval = setInterval(()=>{
    // double pulse "lub-dub"
    const now = audio.ctx.currentTime;
    pulse(now); pulse(now + 0.18);
  }, (60/bpm)*1000);

  function pulse(time){
    g.gain.cancelScheduledValues(time);
    g.gain.setValueAtTime(0.0, time);
    g.gain.linearRampToValueAtTime(0.25, time + 0.02);
    g.gain.exponentialRampToValueAtTime(0.001, time + 0.45);
  }
  audio.hbGain = g; audio.hbOsc=o;
}
function stopHeartbeat(){
  if(audio.hbInterval){ clearInterval(audio.hbInterval); audio.hbInterval=null; }
  if(audio.hbGain){ try{ audio.hbGain.disconnect(); }catch{} audio.hbGain=null; }
  if(audio.hbOsc){ try{ audio.hbOsc.stop(); }catch{} audio.hbOsc=null; }
}

function setVolume(v){
  if(audio.master){ audio.master.gain.value = v; }
}

/* ========= Controls ========= */
const beginBtn = document.getElementById("begin");
const stopBtn = document.getElementById("stop");
const vol = document.getElementById("vol");
const hb = document.getElementById("hb");
const langToggle = document.getElementById("lang");
const langLabel = document.getElementById("langLabel");

beginBtn.addEventListener("click", async ()=>{
  beginBtn.disabled = true;
  try{
    if(!audio.ctx) createAudio();
    if(audio.ctx.state === "suspended") await audio.ctx.resume();
    setVolume(parseInt(vol.value,10)/100);
    startType();
    startHeartbeat(hb.checked);
    stopBtn.disabled = false;
  }catch(e){
    console.warn(e);
    beginBtn.disabled = false;
  }
});

stopBtn.addEventListener("click", async ()=>{
  if(audio.ctx){
    await audio.ctx.suspend();
  }
  tw.running = false;
  stopHeartbeat();
  stopBtn.disabled = true;
  beginBtn.disabled = false;
});

vol.addEventListener("input", e=> setVolume(parseInt(e.target.value,10)/100));
hb.addEventListener("change", e=> startHeartbeat(e.target.checked));
langToggle.addEventListener("change", ()=>{
  currentLang = langToggle.checked ? "hi" : "en";
  langLabel.textContent = currentLang.toUpperCase();
  // restart typer for new language
  startType();
});

/* ========= Space Dust Canvas ========= */
const canvas = document.getElementById("space");
const ctx = canvas.getContext("2d", { alpha:true });
let w=0,h=0, dpr=1;
let mouse = { x:0.5, y:0.5 };
const COUNT = 180;
const dust = [];

function resize(){
  dpr = Math.min(2, window.devicePixelRatio || 1);
  w = canvas.clientWidth = window.innerWidth;
  h = canvas.clientHeight = window.innerHeight;
  canvas.width = Math.floor(w * dpr);
  canvas.height = Math.floor(h * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize", resize);
resize();

function makeParticle(){
  return {
    x: Math.random()*w,
    y: Math.random()*h,
    z: Math.random()*1 + 0.2, // depth
    r: Math.random()*1.6 + 0.3,
    vx: (Math.random()-0.5)*0.15,
    vy: (Math.random()-0.5)*0.15,
    a: Math.random()*Math.PI*2
  };
}
for(let i=0;i<COUNT;i++) dust.push(makeParticle());

window.addEventListener("mousemove", e=>{
  mouse.x = e.clientX / w; mouse.y = e.clientY / h;
});

function draw(){
  ctx.clearRect(0,0,w,h);
  // faint starfield wash
  ctx.fillStyle = "rgba(10, 14, 24, 0.55)";
  ctx.fillRect(0,0,w,h);

  for(const p of dust){
    const pullX = (mouse.x - 0.5) * 0.12 * p.z;
    const pullY = (mouse.y - 0.5) * 0.12 * p.z;
    p.x += p.vx + pullX;
    p.y += p.vy + pullY;
    p.a += 0.005 + (1-p.z)*0.01;

    // wrap
    if(p.x < -10) p.x = w+10; if(p.x > w+10) p.x = -10;
    if(p.y < -10) p.y = h+10; if(p.y > h+10) p.y = -10;

    const alpha = 0.25 + 0.45*(1-p.z);
    const size = p.r * (1.2 + Math.sin(p.a)*0.2);
    const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, size*6);
    grad.addColorStop(0, `rgba(139, 211, 221, ${alpha})`);
    grad.addColorStop(1, "rgba(139, 211, 221, 0)");
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(p.x, p.y, size, 0, Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(draw);
}
draw();

// Initial render
renderType();
</script>
</body>
</html>